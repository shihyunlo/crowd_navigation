\documentclass[conference]{IEEEtran}
\usepackage{times}

% numbers option provides compact numerical references in the text. 
\usepackage[numbers]{natbib}
\usepackage{multicol}
\usepackage[bookmarks=true]{hyperref}


\usepackage{amsfonts}                                                           
\usepackage{amsmath}                                                            
\usepackage{amssymb}                                                            
\usepackage{graphicx}                                                           
\usepackage{graphics}                                                           
\usepackage{epsfig}                                                             
\usepackage{mathptmx}                                                           
\usepackage{url}                                                                
\usepackage[l]{floatflt}                                                        
\usepackage{rotating}                                                           
\usepackage{subfigure}                                                          
\usepackage{multicol}                                                           
\usepackage{algorithm}                                                          
\usepackage{algorithmic}                                                        
\usepackage{verbatim}                                                           
\usepackage{listings}                                                           
\usepackage{chngpage}                                                           


\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}

\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}

\long\def\commentl#1{{\bf **Shih-Yun: #1**}}
\long\def\commentp#1{{\bf **Peter: #1**}}

\begin{document}

%\title{Towards Modeling Real-world Human-robot Interaction that Prevents Overfitting}
\title{Iterative Human-Aware Mobile Robot Navigation}


\author{
    \authorblockN{Shih-Yun Lo, Benito Fernandez, and Peter Stone}
    \authorblockA{
        University of Texas at Austin\\
        {\tt \{yunl;pstone\}@cs.utexas.edu;benito@utexas.edu}
    }
}


\maketitle

\begin{abstract}
Mobile robot navigation in human populated environments has been
widely studied in the past two decades. Significant improvements in
this technology suggest a promising future for introducing mobile
service robots in human workspaces that help with daily
activities. State-of-the-art approaches have shown real-world
deployments of robots that can safely navigate through dense
crowds~\cite{trautman2015robot, pfeiffer2016predicting}. Still, most
robots lack the ability to navigate in a human-friendly manner, which
requires the ability to identify human intentions in situations with
high risk of collision, and to avoid such collisions
“legibly”~\cite{dragan2013legibility}. Most studies to date do not
take human-robot interaction into consideration, resulting in
unexpected human behaviors during deployment, and complicates
planning.  In particular, real-world deployment requires
distinguishing humans who are trying to pass the robot from those who
intentionally block the robot during navigation.  To this end, we
model the planning of pedestrians who are trying to pass the robot as
solving a constrained optimization problem, arriving at their
destination as quickly as possible, while remaining sufficiently far
away from the robot so as not to risk colliding.  People that deviate
from an expected plan can be considered to be interacting directly
with (e.g.\ blocking) the robot.  Preliminary results show that within
this framework, people's paths for passing the robot depend heavily on
the robot's behavior policy, necessitating an incremental training
paradigm that generated expected paths that react to the robot's
current policy, and vice versa.

\end{abstract}

\IEEEpeerreviewmaketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
\vspace{-0.3em}
\label{sec:intro}
\noindent
% [mobile robot navigation advances in dynamic environment]
%In robotics, recent advances have allowed long-term autonomy for indoor mobile 
%robot navigation, which has raised interest in the development of service 
%robots that provide assistance to humans during daily activities. To achieve 
%this objective, the robots need to be able to navigate smoothly among pedestrians, while 
%not interfering with their ongoing activities. 
%%This problem involves 
%%modeling well the dynamics in human-robot interaction, where individuals have 
%%independent goals to reach and potential collisions need to be avoided. 

% [human robot interaction scenarios]
Consider a robot navigating in a busy atrium with people walking towards 
different destinations. There is generally limited sensing of nearby agents, 
both by the human pedestrians and by the robot. It is not enough to reactively 
avoid imminent collisions. However, when predicting into the future, 
collision avoidance algorithms often fail to find a path in 
densely crowded environments, sometimes referred to as the "freezing robot 
problem"~\cite{trautman2010unfreezing}. For example, in human pedestrian 
navigation, it is commonly seen for agents to walk in front of one 
another to maximize their own travel efficiency, assuming other pedestrians 
are aware of the workspace occlusion and respond safely. Can the robot act 
the same way, while optimizing the joint efficiency of both agents?  

% [state of the art robot navigation in crowd]
To plan efficiently in dense crowds at the same time maintaining 
human-friendliness and safety, it is crucial to have good models of human 
responses to the robot's maneuvers. Many approaches have been proposed in the 
past decade to simulate human pedestrian dynamics~\cite{lamarche2004crowd, 
  %treuille2006continuum, %paris2007pedestrian, 
karamouzas2009predictive}.
%Accordingly, robot planning in crowds has shown efficient performance in simulation
Look ahead planning, that includes a model of how others will react to one's 
own motion, is required. It's also important to keep in mind that people may 
respond to robots differently than they respond to other people. Large 
prediction errors of state-of-the-art approaches have suggested a large gap 
between real-world deployment and 
simulation~\cite{trautman2015robot,pfeiffer2016predicting}. When 
relying on models for lookahead planning, if people act unpredictably (or in a 
way not observed in the training data), safety can be compromised. 

%%to eliminate the gap between human-robot interaction modeling and real-world deployment
We therefore propose to train a predictive model from 
data collected during real-world human-robot interaction, and 
act online according to the learnt predictive model to obtain new training data. 
This iterative process will help ensure consistency between the robot's 
prediction of pedestrian's trajectories and their true trajectories in the 
presence of the robot's actual actions.

%With this process, we aim to achieve robot planning in 
%crowds that not only follows the inherent interaction patterns in human 
%pedestrians, but also counts in the noisy interaction where people intentional 
%block the robot.

%% to deal with human intentions for trajectory prediction
To achieve smooth robot maneuvering in human crowds, it is essential to 
systematically identify whether the person is focused on 
reaching their goal (conducting natural navigating behaviors), or may be 
distracted by the presence of robot (conducting unnatural navigating 
behaviors, such as blocking). To model this problem, we propose to first 
enable prediction of human traversal behaviors when encountering potential 
collisions, shown in Fig.~\ref{fig1}. 


\begin{figure}[t]
  \begin{center}
  \hspace*{-1em}
  \subfigure[0.45\columnwidth][] {
    \includegraphics[width=0.5\columnwidth]{p1.png}
    \label{fig:p1}
  }\hspace*{-0.03em}
  \subfigure[0.45\columnwidth][] {
    \includegraphics[width=0.5\columnwidth]{p2.png}
    \label{fig:p2}
  }
  \end{center}
  \vspace{-0.85em}
  \caption{The two pictures illustrate the common patterns of human 
    pedestrians passing the other agent (here the robot) to avoid a potential 
    collision (with the robot 
    moving towards the door, the pedestrian moving to the stair case at the left): {\bf (a)} to 
    decelerate and wait for the robot passing in front, 
    {\bf (b)} to accelerate and pass in front of the robot. Two styles of 
    traversal trade off between total path lengths and end speeds. While 
    slowing down to wait results in shorter paths, speeding up to pass in 
    front is also commonly observed when people navigate in crowds. 
    }  
  \vspace{-0.6em}
\label{fig1}
\end{figure}


%When the robot performs 
%``legibly''~\cite{dragan2013legibility} in those 
%situations, non-cooperative behaviors (intentional blocking) can be identified if not 
%classified into any type of traversal. 

 %we also propose to model the interactive dynamics based on local 
%observations, which helps the applicability of the approach in varied 
%environments. It is a contrained optimization problem on temporal collision 
%including its safety margins. The prediction process then falls in first deciding 
%which way the agent is prone to take, and how it would adapt its dynamics during 
%traversal. Accordingly, the controller looks ahead and optimizes the joint 
%efficiency subjected to the estimate of human traversal preferences.

We model the pedestrians as solving a constrained path optimization 
problem during traversal, which maintains the safe distances from the other agents while reaching 
their destination as quickly as possible. This approach provides us the 
capability to predict which path the 
pedestrian is prone to take to avoid, at what speed pattern. The robot can 
then optimize the joint efficiency by avoiding responsively to their 
preferences, legibly, such that the pedestrian 
is clear about the robot's intention. Our model then predicts cooperative behavior from rational pedestrians; non-cooperative behavior, such as intentional blocking, can therefore be distinguished if the pedestrian does not follow any expected patterns.

%Towards the deployment of a service robot in real world, the robust guarantee of safety during human robot interaction is important. Still, state-of-the-art modeling of this joint dynamics has limited capability when pedestrians engage in behaviors not presented in the training data. With complex model and unbalanced training data, the prediction model is under high risk of overfitting.

% local sensing, local representation (no global goal)
% the limited predicting capability when people engage in behaviors not present in the training data
%When navigating in a crowded environment, people observe other agents' behaviors, and act accordingly. With different dynamics observed, people conduct different motion patterns. The same situation applies to human robot interaction as well. If the pedestrians observe aggressive behaviors during robot navigation, they may perform conservatively by staying away from the robot to avoid collision; if the robot appears to be respond safely to disturbances in the environment, people may trust the robot more and interact with it more closely. 
%To solve this problem, we acknowledge that different pedestrian behaviors are excited under different robot maneuver policies. The learnt pedestrian dynamics may only capture partial interactive behaviors with the robot given its conducted policy. For example, if the robot navigates in the crowd with conservative avoiding behaviors, the learnt interaction would be limited as treated as a static obstacle; on the other hand, aggressive robot navigation may result in pedestrian avoiding behaviors where limited interaction is experienced. 

% introduce this work that does not overfit


\vspace{-0.2em}
\section{Related Work}
\label{sec:related}
\vspace{-0.4em}
% recent advance in crowd navigation modeling
% a) physics-based modeling of pedestrian spacing 
% b) inverse optimal planning techniques
The earliest attempt to model pedestrian behaviors was through a physics-based 
modeling approach, in which the spacing between pedestrians follows a 
potential field to generate collision-safe 
interactions~\cite{helbing1995social}. Following this work, explicit models 
for local collision avoidance were widely studied, to model the subtle 
adaptive personal-spacing behaviors in pedestrian 
interactions~\cite{papadakis2014adaptive}. Meanwhile, another community 
makes use of inverse optimal planning 
techniques~\cite{ziebart2009planning,henry2010learning,vasquez2014inverse} to 
model pedestrian dynamics by learning their policies assuming global observations and 
rational behaviors.
% a,b ignore the interactive dynamics in which one player's action affects the other's 
% c) joint decision making process
While the above approaches have shown to predict pedestrian motions 
offline or in simulation, an issue arose with the Markov Decision 
Process assumption when the methods were deployed on a robot to navigate in real world:
the real-time dynamics of pedestrians are also dependent on the robot's 
actions. 
%While the pedestrians treat the robot as an agent, they plan 
%accordingly to robot's motion. 

In this regard, a multi-player game setting including both human and robot actions into the joint state space was proposed and evaluated on a mobile robot in a fully-observed environment~\cite{trautman2010unfreezing}. This game setting has also shown significant results in autonomous cars through the consideration of human actions into their model to achieve communicative robot behaviors~\cite{sadigh2016planning}.
% d) prediction using offline training data does not always work: data may be from rational agents. Further, interactive data may only go from a small portion of state space, excited by pre-defined robot behavior 
Still, all of the above work are built from data collected by observing human-human 
interaction, which has degraded planning performance while encountering unmodeled 
human-robot interaction during real-world 
deployment~\cite{trautman2015robot, pfeiffer2016predicting}. To achieve 
cooperative interaction with humans and robots sharing a workspace, it is 
an essential capability for the robot to identify people's 
intentions, and then plan responsively to their actions. We propose to achieve 
better human-robot interaction in crowds by learning a predictive model 
iteratively through online interaction, and propose a predictive model 
that generates plans to avoid dynamic obstacles based on personal walking features. 
\vspace{-0.1em}
\section{Methodology}
\vspace{-0.1em}
We model the pedestrians as moving according to the solution to a constrained optimization 
problem, and formulate the constraints on the temporal collisions with 
(adaptive) safety margins, from a first person point of view. We assume that 
people have some fuzzy idea of the velocity of the other agent $v^o$, of their 
own velocity $v^p$, and the location where an expected collision will happen $p^{col}$:
\begin{equation}
min_{u_n \dots u_N} \Sigma^N_{t=n} \small{dx_t^TQdx_t + u_t^TRu_t + \omega C_{soc}+(x_N-x^G)^TP(x_N-x^G)}
\end{equation}

The temporal constraint divides the 2D planning configuration space into two 
homotopy classes, which leads to two commonly observed traversal options, 
considering a two-player scenario: to slow down and traverse from behind by 
freeing the expected occupation at intersection (passive action, $a^{p}$, as 
shown in Fig.~\ref{fig:p1}), as well as to speed up and pass in front by postponing 
the expected intersection (active action, $a^a$ as shown in Fig.~\ref{fig:p2}).

Note that, from the path planning perspective, there exists a third homotopy 
class to pass from behind,
%by turning some degrees towards the other agent, 
resulting in earlier traversal time. This maneuver is seldom seen in 
crowds because of the inconsistency between intention (passive traversal from 
behind) and motion pattern (active traversal by speeding up). It also results in 
longer path and raises the risk of breaking in front of the other agent's 
safety margin. 

%% state space representation, 
% from robot's perspective, with a figure showing desired vel, goal..etc

\subsection{Human Traversal Decision Hypothesis} 
From an optimal path planning perspective, we can assign costs to 
the observed path, and there are different approaches to explain or predict the likelihood of such path based on assumptions on the decision making process~\cite{ratliff2006maximum, ziebart2008maximum}, or social cost function formulations~\cite{kruse2012legible}. For example, in \cite{trautman2010unfreezing},
the authors collected data on human navigation in crowds, and proposed the Gaussian 
process mixture model to predict in real-time the pedestrian paths. Due to the 
goal-imposed behavior formulation (which highly limits the applicability of 
their approach in different domains), this model is also used during robot 
planning. 

From an inverse optimal planning perspective, with the constrained 
optimization setting on human path planning subject to the other agent 
crossing, we can learn the cost function of human traversal behaviors. More specifically, with the aid of social proximity model and social cost function, and the intuition from social 
force model on travel directions, we can formulate social-friendly cost model on 
human crossing:
%%%%
and learn the coefficients that best describe the observed behaviors.  
%% interaction comparison - social force, social proximity, adaptive social 
%% spacing. The insights in human robot interaction: people tend to travel 
%% from in front, people have different social preferences (w/ people, w/ 
%% robots), people having higher repelling/costs traveling the opposite 
%% direction with the crowd  

However, as suggested in %%adaptive social spacing
people have different degrees of interest in interaction, which we also 
observed in our robot's real-world deployment. Beyond interest, we also 
observed different motion 
patterns when humans traverse a robot, which suggests different perceptions and 
reactions on autonomous navigating agents. For example, when people observe a 
potential collision, the psychology tension to change maneuvers has personal 
differences. Same is true for the safety margin (minimum distance to respond 
to collision) people tend to keep from other agents, subject to different walk 
speed and crowd density. 
Going back to the formulation 
suggested in Eq., it suggests that different people have different weights on 
the cost terms, resulting in different social preferences in collision-risky 
scenarios. 

Coming back to the application of pedestrian motion prediction and the 
robot planning accordingly, if one were to extract the motion features of a 
person given past observation, to predict the weights on the cost function for 
social preferences, the overall cost function formulation would be to learn 
a functional mapping $w$ as a function of the dynamic features of the person. 

One solution to maintain the tractability of the model, especially under 
limited data from real-world experience, is to enforce sparsity of the mapping 
function $w$. This can be explained as to limit the variety of traversal 
preferences.
\subsection{Intention Expression and Opponent Response Hypothesis during Human Traversal}
When observing human navigation in crowds, it is commonly seen that the 
\textit{dynamic patterns} of motion, such as speed variations, are coupled 
with intention. This somehow differs from the 
definition of legibility as being goal-expressive in %
, and falls back to the early description of legibility as to be intention 
expressive and predictable: we slow down to wait for the other crossing agent 
(passive traversal $a^p$), which often leads to short paths that do not much 
deviate from the original undisturbed paths (also suggested in %
). Or we speed up to show the 
aggressive intention to temporally occupy the crossing agent's workspace (active 
traversal $a^a$). 

While intention affects the speed pattern of the path taken, it also has 
correlation with interaction preferences, which correspond to different $\omega$ 
values. For example, aggressive people, defined as people who prefer to actively traverse 
other agents, tend to react early once they observe potential collisions and 
to keep a large safety margin from the others. The choice of optimal path 
differs with different intentions; same is true for the homotopy class the 
path belongs to.

People usually pose the hypothesis that, during navigation in crowds, other 
people are able to \textit{understand intention expressive motions} and \textit{respond safely 
and friendly} 
accordingly. However, during human-robot interaction, this hypothesis may not 
necessarily hold, based on our preliminary study on the robot's real-world 
deployment. It was common feedback we got that people described themselves as 
``aware'' of the robot, which we interpreted as ``requiring constant 
attention''. They also suggested that they were not capable of navigating as 
comfortably as in human crowds.
\begin{figure}[tb]
  \begin{center}
  \hspace*{-2em}
    \includegraphics[width=1.05\columnwidth]{images/behavior_change.pdf}
  \hspace*{-2em}
  \vspace*{-1.5em}
  \end{center}
  \vspace{-0.05in}
  \caption{We propose this schematic illustration of human action model based 
    on the psychological process analysis on behavioral changes in %%
    Here, we further distinguish stimulus by various levels of response time 
    (psychology tension) 
    }
\label{behavior_change}
\end{figure}
\subsection{Human Decision Model considering Opponent Status and Intention Hypothesis}
We therefore propose to model people's decision making process during 
traversal considering both self stimulus and opponent agent hypothesis, as 
shown in Fig..%% 
More specifically, we consider sources of stimulus based on different levels of 
response time and frequency of variation. For example, goal and interest are 
usually fixed during the navigation process. Immediate instances such as 
unexpected turns of nearby agents cause direct threat and therefore stimulate 
responses quickly.

Our subject, which is human traversal decision in crowds, is considered as potential 
threat due to possible collision. It has certain response time (people don't 
react right after observing a confronting agent), and it relies assumptions on 
opponent behaviors to make the traversal decision that maximizes the person's 
own utility. 

Here, we list out the opponent assumptions on his status, defined as the 
state with abstract psychological description, and intention, defined as the potential 
action of interest. The opponent status can be estimated based on past 
observations, such as to distinguish if she is wondering in the hallway, or 
traveling towards a specific goal. The intention is what we care about the most at 
the end: is she going to cross me in the front or wait?

In human-robot interaction, the status goes 
beyond: is the person comfortable with the robot? Does she considers the robot 
to be safe? As for intentions, we might further consider: is the person 
blocking, or following the robot? 

In each case, we incorporate the opponent agent's influence into the decision 
making process. With that said, his action is taken into account while people 
consider their own actions. 
\subsection{Preliminary Results}
%heading variation suggests interactability
%different safety margins on traversal type decision
%psychology tension oh reaction time
%% however, more specifically: who have what interaction preferences? we don't 
%% know their intention, neither hypothesis of the robot. how can we achieve 
%% intent expressive motion in a human-friendly way?
Based on the above, we first study:
\begin{enumerate}
\item the opponent hypothesis in human-robot interaction, assuming 
  self-interested behaviors in a game theory setting, and
\item the dynamic patterns during human traversal around a robot, to 
  understand their traversal intention expression and the expectation of robot 
  response (so we can design robot's legible motions).
\end{enumerate}

We conduct experiments in an open atrium with the robot following pre-assigned 
routes. We first show the participants how the robot runs the task, and then 
ask them to travel between four sets of waypoints that collision may happen in 
between. Each participant takes the experiment twice, with different values of 
safety margin ($0.3m$ and $1m$) that the robot keeps from the collision. Six 
people were invited in the test, with no prior experience to interact with the 
tested platform.

The results that record:
\begin{enumerate}
  \item close-distance interaction trajectories,
  \item velocity profile over time,
  \item heading profile (velocity direction) over time,
  \item velocity profile over the relative distance between two agents,
  \item heading profile over the relative distance between two agents,
\end{enumerate}
are shown in Fig.%%


After all, we care about predicting human motion in a cost-effective way, and 
the intention expression when people's behavior are not well 
predicted. %% more explanation
%%graphs of dynamics results
\begin{figure*}[tb]
  \begin{center}
  \hspace*{-6em}
    \includegraphics[width=1.2\textwidth]{images/dynamic_result2.png}
  \hspace*{-1em}
  \vspace*{-1.5em}
  \end{center}
  \vspace{-0.1in}
  \caption{We propose this schematic illustration of human action model based 
    on the psychological process analysis on behavioral changes in %%
    Here, we further distinguish stimulus by various levels of response time 
    (psychology tension) 
    }
\label{behavior_change}
\end{figure*}
\subsection{Mathematical Models}
%preferences

%dynaimc transition (how they would react to robot legible motions)






%% definition of dynamics transition(our model applies to goal-oriented pople) 
%- whenever the person changes the maneuver to avoid the other agent (also, 
%when do they express intention, which they may express?)
% need to estimate collision location, response region, and safety margin

%% human-robot interaction intent hypothesis: different classes of people have 
%different social interactions, adaptive KF

%%intent expressive motion design - the leading agent




%% logistic regression on decision manifold
Based on the continuous control input $u^o$ (here the robot acceleration), the 
relative distance $d^{rel}$, and the adaptive safety margin $d^{saf}$ to 
allow for unexpected behaviors of the robot, we model the pedestrian 
decision making over passive ($a^p$) or active action ($a^a$) by logistic regression,
\begin{equation}
p(a=a^p|x,u^o) \sim \frac{1}{1+e^{w^Tf(x,u^o)}}, %%they should be of past trajectory?
\end{equation}
where $x$ is the overall system state, including the pedestrian and confronting agent, and $f(x,u)$ is a feature function, capturing the relative dynamics of the two agents.

%\section{Preliminary Results}
%Preliminary results have suggested the dependency of people's traversal preferences 
%on different regular walking patterns. For example, people who often traverse from 
%the front, have a higher regular walking pace. Since the traversal 
%behavior also depends on the robot's observed behaviors, we collect data under 
%different robot navigation policies. In this workshop, we intend to show the 
%robustness of the proposed pedestrian traversal decision predictor. We also 
%intend to show the learnt interactive dynamics during traversal, through phase 
%space analysis on velocity changes and positions. The resultant optimal 
%policy that maximizes both agents' efficiency is expected to act legibly 
%and responsively to the perceived human pedestrian traversal style. When the 
%prediction fails and the risk of collision goes up, it is quite likely that 
%the pedestrian is intentionally blocking the robot.
%%The decisions of pedestrians are modeled on both waypoint selections (mixture model on different ho%motopy classes, based on speed, relative speed, spacing, and safety margins) and speed pattern adapt%ation (adaptive slow down or speed up to avoid collision, based on the same features). 
\section{Future Work}
Transition pattern prediction, transition manifold selection prediction, 
1.if legible motion would improve the transition smoothness, has the effect of 
enhanced friendliness
2.iterative learning on transition model with intent-expressive motions
%% is it ok to cross from behind? From the social force, yes; from the social 
%% proximity on visibility - no. 


{\footnotesize
\bibliographystyle{plainnat}
\bibliography{reference}
}
\end{document}


